<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <title>Calculadora de escada</title>
    <style>
        body {
            font-size: 14px;
            font-family: sans-serif;
            margin: 24px;
        }

        .fields {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 24px 32px;
            background-color: #f2f2f2;
            border-radius: 16px;
        }

        .fields>div {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        input {
            width: 200px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 18px;
            font-family: inherit;
        }

        input:disabled {
            background-color: #eee;
        }

        .calculator {
            display: flex;
        }

        #draw {
            display: flex;
            flex-grow: 1;
            align-items: center;
            justify-content: center;
            height: 600px;
        }

        #draw canvas {
            width: 100%;
            height: 100%;
        }

        .about {
            display: flex;
            flex-direction: column;
            margin: 24px 0;
            gap: 8px;
            padding: 0 0 24px;
        }

        .about p {
            margin: 0;
        }

        h1 {
            margin: 0 0 24px;
        }
    </style>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JTFFT24JP7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-JTFFT24JP7');
    </script>
</head>

<body>
    <h1>Calculadora de escada</h1>

    <div class="calculator">
        <div class="fields">
            <div>
                <label for="height">Altura de piso a piso (mm)</label>
                <div><input type="text" name="height" id="height" placeholder="Altura de piso a piso" value="2600" />
                </div>
            </div>
            <div>
                <label for="width">Espaço (mm)</label>
                <div><input type="text" name="width" id="width" placeholder="Espaço" value="4400" /></div>
            </div>
            <div>
                <label for="steps">Número de degraus</label>
                <div><input type="text" name="steps" id="steps" placeholder="Número de degraus" value="15" /></div>
            </div>
            <div>
                <label for="riser">Espessura do espelho (mm)</label>
                <div><input type="text" name="riser" id="riser" placeholder="Espessura do espelho" value="15" /></div>
            </div>
            <div>
                <label for="tread">Espessura do piso (mm)</label>
                <div><input type="text" name="tread" id="tread" placeholder="Espessura do piso" value="15" /></div>
            </div>
            <div>
                <label for="nosing">Nariz (mm)</label>
                <div><input type="text" name="nosing" id="nosing" placeholder="Nariz" value="10" /></div>
            </div>
            <div>
                <label for="stepHeight">Altura do degrau (mm)</label>
                <div><input type="text" name="stepHeight" id="stepHeight" disabled /></div>
            </div>
            <div>
                <label for="stepWidth">Piso do degrau (mm)</label>
                <div><input type="text" name="stepWidth" id="stepWidth" disabled /></div>
            </div>
            <div>
                <label for="angle">Ângulo (graus)</label>
                <div><input type="text" name="angle" id="angle" disabled /></div>
            </div>
        </div>
        <div id="draw">
            <canvas></canvas>
        </div>
    </div>

    <div class="about">
        <p>Segundo a NBR 9050</p>
        <p>1. A altura do degrau deve ficar entre 16 e 18 cm</p>
        <p>2. O piso do degrau deve ficar entre 28 e 32 cm</p>
    </div>

    <script>
        function floatInput(selector) {
            const value = document.querySelector(selector).value;
            return parseFloat(value);
        }

        function hypotenuse(adjacent, opposite) {
            return Math.sqrt(Math.pow(adjacent, 2) + Math.pow(opposite, 2));
        }

        function angle(hypotenuse, opposite) {
            return Math.atan(opposite / hypotenuse) * (180 / Math.PI);
        }

        function angle2(adjacent, opposite) {
            return Math.atan2(opposite, adjacent) * (180 / Math.PI);
        }

        class Stair {
            constructor(ctx) {
                this.ctx = ctx;
            }

            line(x1, y1, x2, y2, dashed = false, color = 'black') {
                this.ctx.beginPath();
                this.ctx.moveTo(x1, y1);
                this.ctx.lineTo(x2, y2);
                this.ctx.strokeStyle = color;
                if (dashed) this.ctx.setLineDash([2, 3]);
                this.ctx.stroke();
                this.ctx.setLineDash([]);
            }

            rect(x, y, width, height) {
                this.ctx.beginPath();
                this.ctx.rect(x, y, width, height);
                this.ctx.strokeStyle = "black";
                this.ctx.fillStyle = "white";
                this.ctx.fill();
                this.ctx.stroke();
            }

            text(x, y, value, rotate = false, color = 'black') {
                this.ctx.save();
                this.ctx.translate(x, y);
                if (rotate) {
                    this.ctx.rotate(Math.PI / 2);
                }
                this.ctx.font = "12px Arial";
                this.ctx.fillStyle = color;
                this.ctx.textAlign = "center";
                this.ctx.fillText(value, 0, 0);
                this.ctx.restore();
            }

            drawStep(x, y, n, height, width, riser, tread, nosing) {
                const x1 = x + n * width;
                const y1 = y - n * height;
                this.line(x1, y1, x1, y1 - height);
                this.rect(x1, y1 - height, riser, height);
                this.line(x1, y1 - height, x1 + width, y1 - height);
                this.rect(x1 - nosing, y1 - height, width + riser + nosing, tread);
            }

            measureX(from, to, y, shadowBegin, shadowEnd, label, labelPos = -6) {
                this.text((from + to) / 2, y + labelPos, label, false, 'blue');
                this.line(to, y, to, shadowEnd, true);
                this.line(from, y, from, shadowBegin, true);
                this.line(from, y, to, y, false, 'blue');
                this.line(from, y, from + 6, y + 6, false, 'blue');
                this.line(from, y, from + 6, y - 6, false, 'blue');
                this.line(to, y, to - 6, y + 6, false, 'blue');
                this.line(to, y, to - 6, y - 6, false, 'blue');
            }

            measureY(from, to, x, shadowBegin, shadowEnd, label, labelPos = 6) {
                this.text(x + labelPos, (from + to) / 2, label, true, 'blue');
                this.line(shadowBegin, from, x, from, true);
                this.line(shadowEnd, to, x, to, true);
                this.line(x, from, x, to, false, 'blue');
                this.line(x - 6, from - 6, x, from, false, 'blue');
                this.line(x + 6, from - 6, x, from, false, 'blue');
                this.line(x - 6, to + 6, x, to, false, 'blue');
                this.line(x + 6, to + 6, x, to, false, 'blue');
            }

            draw() {
                const height = floatInput('input#height');
                const width = floatInput('input#width');
                const riser = floatInput('input#riser');
                const tread = floatInput('input#tread');
                const nosing = floatInput('input#nosing');
                const numberOfSteps = floatInput('input#steps');

                const containerWidth = document.querySelector('#draw').offsetWidth;
                const containerHeight = document.querySelector('#draw').offsetHeight;

                canvas.width = containerWidth;
                canvas.height = containerHeight;

                const drawMargin = 60;
                const drawWidth = canvas.width - 2 * drawMargin;
                const drawHeight = canvas.height - 2 * drawMargin;
                const widthFactor = drawWidth / width;
                const heightFactor = drawHeight / height;
                const factor = Math.min(widthFactor, heightFactor);

                const drawBeginX = (widthFactor > heightFactor ? (drawWidth - width * factor) / 2 : 0) + drawMargin;
                const drawBeginY = (widthFactor < heightFactor ? (drawHeight - height * factor) / 2 + (height * factor) : drawHeight) + drawMargin;
                const drawEndX = drawBeginX + width * factor;
                const drawEndY = drawBeginY - height * factor;
                const drawCenterX = drawBeginX + (width * factor) / 2;
                const drawCenterY = drawBeginY - (height * factor) / 2;

                const stepHeight = height / numberOfSteps;
                const stepWidth = width / numberOfSteps;

                const stairAngle = angle2(width, height);

                document.querySelector('input#stepHeight').value = stepHeight.toFixed(2);
                document.querySelector('input#stepWidth').value = stepWidth.toFixed(2);
                document.querySelector('input#angle').value = stairAngle.toFixed(2);

                for (let i = 0; i < numberOfSteps; i++) {
                    this.drawStep(
                        drawBeginX,
                        drawBeginY,
                        i,
                        stepHeight * factor,
                        stepWidth * factor,
                        riser * factor,
                        tread * factor,
                        nosing * factor
                    );
                }

                const macroMarginTop = 5;
                const macroScale = drawWidth / stepWidth * 0.5;
                const macroStepHeight = stepHeight * factor * macroScale;
                const macroStepWidth = stepWidth * factor * macroScale;
                const macroRiser = riser * factor * macroScale;
                const macroTread = tread * factor * macroScale;
                const macroNosing = nosing * factor * macroScale;

                this.drawStep(drawBeginX, macroStepHeight + macroMarginTop, 0, macroStepHeight, macroStepWidth, macroRiser, macroTread, macroNosing);
                this.measureY(macroStepHeight + macroMarginTop, macroMarginTop, drawBeginX + macroStepWidth + 90, drawBeginX + macroStepWidth + 50, drawBeginX, `${stepHeight.toFixed()} mm`);
                this.measureY(macroStepHeight + macroMarginTop, macroMarginTop + macroTread, drawBeginX + macroStepWidth + 50, drawBeginX, drawBeginX, `${(stepHeight + tread).toFixed()} mm`);
                this.measureX(drawBeginX, drawBeginX + macroStepWidth, macroStepHeight + 50, macroMarginTop, macroMarginTop, `${stepWidth.toFixed()} mm`);
                this.measureX(drawBeginX, drawBeginX + macroStepWidth + macroRiser, macroStepHeight + 90, macroStepHeight + 50, macroMarginTop, `${(stepWidth + riser).toFixed()} mm`);

                this.measureX(drawBeginX, drawEndX, drawBeginY + 50, drawBeginY, drawEndY, `${width} mm`);
                this.measureY(drawBeginY, drawEndY, drawEndX + 50, drawBeginX, drawEndX, `${height} mm`);

                this.line(drawEndX, drawEndY, drawEndX, drawEndY + stepHeight * factor);
                this.line(drawBeginX, drawBeginY, drawBeginX + stepWidth * factor, drawBeginY);
                this.line(drawBeginX + stepWidth * factor, drawBeginY, drawEndX, drawEndY + stepHeight * factor);

                this.text(drawBeginX + stepWidth * factor + 60, drawBeginY - 8, `${stairAngle.toFixed(2)}°`, false, 'blue');
            }
        }

        const canvas = document.querySelector("#draw canvas");
        const ctx = canvas.getContext("2d");
        const stair = new Stair(ctx);

        function drawOnChange(stair, selector) {
            document.querySelector(selector).addEventListener(
                'change',
                () => stair.draw()
            );
        }

        [
            'input#height',
            'input#width',
            'input#steps',
            'input#riser',
            'input#tread',
            'input#nosing',
        ].map(s => drawOnChange(stair, s));

        window.addEventListener('load', () => stair.draw());
    </script>
</body>

</html>
